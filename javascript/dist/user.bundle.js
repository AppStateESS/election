!function(e){function t(i){if(n[i])return n[i].exports;var s=n[i]={exports:{},id:i,loaded:!1};return e[i].call(s.exports,s,s.exports,t),s.loaded=!0,s.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t){"use strict";var n=React.createClass({displayName:"Election",getInitialState:function(){return{election:null,currentSingle:0,currentMultiple:0,currentReferendum:0,single:[],multiple:[],referendum:[],ballotCount:0,referendumCount:0,stage:"loading",singleVote:[],multipleVote:[],referendumVote:[],unqualified:[],backToReview:!1,surveyLink:null,supportLink:null}},componentDidMount:function(){this.load()},load:function(){$.getJSON("election/User/Election",{command:"list"}).done(function(e){var t=this.state.stage;if(e.election)if(e.hasVoted)this.setState({stage:"finished",election:e.election});else{var n=e.single.length,i=e.multiple.length,s=e.referendum.length;t=0===n?0===i?0===s?"empty":"referendum":"multiple":"single";var l=n+i;this.setState({stage:t,hasVoted:e.hasVoted,election:e.election,single:e.single,multiple:e.multiple,referendum:e.referendum,ballotCount:l,referendumCount:s,unqualified:e.unqualified,supportLink:e.supportLink})}else this.setStage("empty")}.bind(this))},setStage:function(e){window.scrollTo(0,0),this.setState({stage:e})},getSingleKey:function(e){var t=0;return $.each(this.state.single,function(n,i){e===i.id&&(t=n)}),t},getMultipleKey:function(e){var t=0;return $.each(this.state.multiple,function(n,i){e===i.id&&(t=n)}),t},getReferendumKey:function(e){var t=0;return $.each(this.state.referendum,function(n,i){e===i.id&&(t=n)}),t},setCurrentSingle:function(e){this.setState({currentSingle:e})},setCurrentMultiple:function(e){this.setState({currentMultiple:e})},setCurrentReferendum:function(e){this.setState({currentReferendum:e})},resetStage:function(e,t){switch(e){case"single":this.setCurrentSingle(this.getSingleKey(t));break;case"multiple":this.setCurrentMultiple(this.getMultipleKey(t));break;case"referendum":this.setCurrentReferendum(this.getReferendumKey(t))}this.setState({backToReview:!0,stage:e})},updateSingleVote:function(e){var t=this.state.stage,n=this.state.currentSingle,i=n+1,s=this.state.singleVote,l=s[n];l={single:this.state.single[this.state.currentSingle],ticket:e},s[n]=l,this.state.backToReview?t="review":"undefined"==typeof this.state.single[i]&&(t=this.state.multiple.length>0?"multiple":this.state.referendum.length>0?"referendum":"review"),window.scrollTo(0,0),this.setState({stage:t,singleVote:s,currentSingle:i})},updateMultipleVote:function(e){var t=this.state.stage,n=this.state.currentMultiple,i=n+1,s=this.state.multipleVote,l=s[n];l={multiple:this.state.multiple[n],chairs:e},s[n]=l,window.scrollTo(0,0),this.state.backToReview?t="review":"undefined"==typeof this.state.multiple[i]&&(t=this.state.referendum.length>0?"referendum":"review"),this.setState({stage:t,multipleVote:s,currentMultiple:i})},updateReferendumVote:function(e){var t=this.state.stage,n=this.state.currentReferendum,i=n+1,s=this.state.referendumVote,l=s[n];l={referendum:this.state.referendum[n],answer:e},s[n]=l,window.scrollTo(0,0),this.state.backToReview?t="review":"undefined"==typeof this.state.referendum[i]&&(t="review"),this.setState({stage:t,referendumVote:s,currentReferendum:i})},finalVote:function(){var e=[];$.each(this.state.singleVote,function(t,n){n.single&&"undefined"!=typeof n.single.id&&n.ticket&&"undefined"!=typeof n.ticket.id&&e.push({singleId:n.single.id,ticketId:n.ticket.id})});var t=[];$.each(this.state.multipleVote,function(e,n){t.push({multipleId:n.multiple.id,chairs:n.chairs})});var n=[];$.each(this.state.referendumVote,function(e,t){n.push({referendumId:t.referendum.id,answer:t.answer})}),$.post("election/User/Vote",{command:"save",electionId:this.state.election.id,single:e,multiple:t,referendum:n},null,"json").done(function(e){e.success===!0?this.setState({backToReview:!1,stage:"finished",surveyLink:e.surveyLink}):this.setState({backToReview:!1,stage:"failure"})}.bind(this)).fail(function(e){this.setStage("failure")}.bind(this))},render:function(){var e=null,t=null;switch(this.state.backToReview&&(t=React.createElement("button",{className:"btn btn-lg btn-block btn-info",onClick:this.setStage.bind(null,"review")},"Return to review without saving")),this.state.stage){case"loading":e=React.createElement("div",{className:"text-center pad-top"},React.createElement("i",{className:"fa fa-spinner fa-spin fa-5x"}));break;case"empty":e=React.createElement(i,null);break;case"finished":e=React.createElement(s,{election:this.state.election,surveyLink:this.state.surveyLink});break;case"single":e=React.createElement(Single,{election:this.state.election,ballot:this.state.single[this.state.currentSingle],updateVote:this.updateSingleVote,vote:this.state.singleVote});break;case"multiple":e=React.createElement(Multiple,{election:this.state.election,ballot:this.state.multiple[this.state.currentMultiple],updateVote:this.updateMultipleVote,vote:this.state.multipleVote,unqualified:this.state.unqualified,supportLink:this.state.supportLink});break;case"referendum":e=React.createElement(Referendum,{election:this.state.election,referendum:this.state.referendum[this.state.currentReferendum],updateVote:this.updateReferendumVote,vote:this.state.referendumVote});break;case"failure":e=React.createElement(r,null);break;case"review":t=null,e=React.createElement(Review,{election:this.state.election,single:this.state.single,multiple:this.state.multiple,referendum:this.state.referendum,singleVote:this.state.singleVote,multipleVote:this.state.multipleVote,referendumVote:this.state.referendumVote,finalVote:this.finalVote,resetStage:this.resetStage})}var n=null;return"single"===this.state.stage&&0===this.state.singleVote.length&&0===this.state.multipleVote.length&&0===this.state.referendumVote.length&&(n=React.createElement(l,{ballotCount:this.state.ballotCount,referendumCount:this.state.referendumCount})),React.createElement("div",null,n,t,e)}}),i=function(){return React.createElement("div",null,React.createElement("h3",null,"No elections are available. Please check back later."))},s=React.createClass({displayName:"Finished",getDefaultProps:function(){return{election:{},surveyLink:null}},render:function(){return React.createElement("div",{className:"row"},React.createElement("div",{className:"col-sm-6 col-sm-offset-3"},React.createElement("div",{className:"well text-center"},React.createElement("h2",null,this.props.election.title),React.createElement("h3",null,"Thank you for voting! Watch SGA for results."),React.createElement("a",{href:"./index.php?module=users&action=user&command=logout",className:"btn btn-lg btn-primary"},"Sign out"),React.createElement("hr",null),React.createElement("p",null,"What do you think about the voting process? ",React.createElement("a",{href:this.props.surveyLink},"Let us know!")))))}}),l=React.createClass({displayName:"Countdown",getInitialState:function(){return{seen:!1}},getDefaultProps:function(){return{ballotCount:0,referendumCount:0,vote:null}},plural:function(e,t,n){return"undefined"!=typeof t&&0!==t.length||(t=""),"undefined"!=typeof n&&0!==n.length||(n="s"),1!=e?n:t},render:function(){var e=null,t=null,n=0,i="are",s="";return this.props.ballotCount>0&&(n+=this.props.ballotCount,e=this.props.ballotCount+" ballot"+this.plural(this.props.ballotCount)),this.props.referendumCount>0&&(n+=this.props.referendumCount,t=this.props.referendumCount+" referend"+this.plural(this.props.referendumCount,"um","a")),n<2&&(i="is"),this.props.ballotCount>0&&this.props.referendumCount>0&&(s="and"),React.createElement("div",{className:"alert alert-info"},"There ",i," currently ",e," ",s," ",t," for you to vote on. We will review all your selections later, before your votes are submitted.")}}),r=React.createClass({displayName:"Failure",render:function(){return React.createElement("div",null,React.createElement("h2",null,"Sorry"),React.createElement("p",null,"Your vote failed to register. Please try again or report the problem."))}});ReactDOM.render(React.createElement(n,null),document.getElementById("election"))}]);
//# sourceMappingURL=user.bundle.js.map