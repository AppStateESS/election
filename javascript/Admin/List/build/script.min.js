"use strict";var ReactCSSTransitionGroup=React.addons.CSSTransitionGroup,Panel=React.createClass({displayName:"Panel",getDefaultProps:function(){return{type:"default",heading:"",body:"",footer:"",footerClick:null,headerClick:null}},render:function(){var a=null;this.props.heading&&(a=React.createElement("div",{className:"panel-heading",onClick:this.props.headerClick},this.props.heading));var b=null;this.props.body&&(b=React.createElement("div",{className:"panel-body"},this.props.body));var c=null;this.props.footer&&(c=React.createElement("div",{className:"panel-footer",onClick:this.props.footerClick},this.props.footer));var d="panel panel-"+this.props.type;return React.createElement("div",{className:d},a,React.createElement(ReactCSSTransitionGroup,{transitionName:"expand",transitionEnterTimeout:500,transitionLeaveTimeout:500},b),c)}}),BreakIt=function(a){if("undefined"==typeof a)throw"BreakIt text parameter is undefined";var b=a.split("\n").map(function(a,b){return React.createElement("span",{key:b},a,React.createElement("br",null))});return b},AbstainButton=function(a){return React.createElement("div",{className:"btn btn-warning btn-lg",onClick:a.handleClick},"Abstain from ",a.title," ",React.createElement("i",{className:"fa fa-arrow-right"}))},DateMixin={initStartDate:function(){$("#start-date").datetimepicker({minDate:tomorrow,value:this.state.startDate,format:dateFormat,onChangeDateTime:function(a,b){this.updateStartDate(this.refs.startDate.value)}.bind(this)})},initEndDate:function(){$("#end-date").datetimepicker({minDate:0,format:dateFormat,value:this.state.endDate,onChangeDateTime:function(a,b){this.updateEndDate(this.refs.endDate.value)}.bind(this)})},changeStartDate:function(a){this.updateStartDate(a.target.value)},changeEndDate:function(a){this.updateEndDate(a.target.value)},hasDateErrors:function(){var a=!1;return 0===this.state.startDate.length?($(this.refs.startDate).css("borderColor","red").attr("placeholder","Please enter a start date"),a=!0):this.state.unixStart>this.state.unixEnd&&($(this.refs.endDate).css("borderColor","red").attr("placeholder","End date must be greater").val(""),this.setState({endDate:"",unixEnd:0}),a=!0),0===this.state.endDate.length&&($(this.refs.endDate).css("borderColor","red").attr("placeholder","Please enter a end date"),a=!0),a},updateStartDate:function(a){var b=new Date(a),c=b.getTime()/1e3;this.setState({startDate:a,unixStart:c})},updateEndDate:function(a){var b=new Date(a),c=b.getTime()/1e3;this.setState({endDate:a,unixEnd:c})},checkForConflict:function(){return $.getJSON("election/Admin/Election",{command:"checkConflict",startDate:this.state.unixStart,endDate:this.state.unixEnd,electionId:this.props.electionId})},showStartCalendar:function(){$("#start-date").datetimepicker("show")},showEndCalendar:function(){$("#end-date").datetimepicker("show")},resetBorder:function(a){$(a.target).removeAttr("style")}},_extends=Object.assign||function(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c)Object.prototype.hasOwnProperty.call(c,d)&&(a[d]=c[d])}return a},ElectionList=React.createClass({displayName:"ElectionList",getInitialState:function(){return{elections:[],showForm:!1}},componentDidMount:function(){this.load()},load:function(){$.getJSON("election/Admin/Election",{command:"list"}).done(function(a){this.setState({elections:a})}.bind(this))},showForm:function(){this.setState({showForm:!0})},hideForm:function(){this.setState({showForm:!1})},render:function(){var a=this.state.elections.map(function(a,b){return React.createElement(ElectionRow,_extends({key:b},a,{hideForm:this.hideForm}))}.bind(this)),b=React.createElement("button",{className:"btn btn-success",onClick:this.showForm},React.createElement("i",{className:"fa fa-plus"}," Add Election"));return this.state.showForm&&(b=React.createElement(ElectionForm,{hideForm:this.hideForm,load:this.load})),React.createElement("div",null,b,React.createElement("table",{className:"table table-striped pad-top"},React.createElement("tbody",null,React.createElement("tr",null,React.createElement("th",null,"Title"),React.createElement("th",null,"Date range"),React.createElement("th",null,"Total votes"),React.createElement("th",null,"Â ")),a)))}}),ElectionRow=React.createClass({displayName:"ElectionRow",getDefaultProps:function(){return{id:0,title:"",startDateFormatted:"",endDateFormatted:"",totalVotes:0,past:!1,edit:!1}},render:function(){if(this.props.past)var a="election/Admin/Report/?electionId="+this.props.id,b=React.createElement("a",{href:a,className:"btn btn-info"},React.createElement("i",{className:"fa fa-envelope"})," Report");else var a="election/Admin/?command=edit&electionId="+this.props.id,b=React.createElement("a",{href:a,className:"btn btn-primary"},React.createElement("i",{className:"fa fa-edit"})," Edit");return React.createElement("tr",null,React.createElement("td",null,this.props.title),React.createElement("td",null,this.props.startDateFormatted," - ",this.props.endDateFormatted),React.createElement("td",null,this.props.totalVotes),React.createElement("td",null,b))}}),ElectionForm=React.createClass({displayName:"ElectionForm",mixins:[DateMixin],getInitialState:function(){return{title:"",startDate:"",endDate:"",unixStart:0,unixEnd:0}},getDefaultProps:function(){return{electionId:0,title:"",startDate:"",endDate:"",hideForm:null}},componentDidMount:function(){this.initStartDate(),this.initEndDate()},componentWillMount:function(){this.props.electionId&&this.copyPropsToState()},copyPropsToState:function(){this.setState({title:this.props.title,startDate:this.props.startDateFormatted,endDate:this.props.endDateFormatted,unixStart:this.props.startDate,unixEnd:this.props.endDate})},updateTitle:function(a){this.setState({title:a.target.value})},checkForErrors:function(){var a=!1;return 0===this.state.title.length&&($(this.refs.electionTitle).css("borderColor","red").attr("placeholder","Please enter a title"),a=!0),this.hasDateErrors()&&(a=!0),a},save:function(){var a=this.checkForErrors();if(a===!1){var b=this.checkForConflict();b.done(function(a){a.conflict===!1?$.post("election/Admin/Election",{command:"save",electionId:this.props.electionId,title:this.state.title,startDate:this.state.unixStart,endDate:this.state.unixEnd},null,"json").done(function(a){this.props.load()}.bind(this)).always(function(){this.props.hideForm()}.bind(this)):($(this.refs.startDate).css("borderColor","red").attr("placeholder","Date conflict"),$(this.refs.endDate).css("borderColor","red").attr("placeholder","Date conflict"),this.setState({startDate:"",unixStart:0,endDate:"",unixEnd:0}))}.bind(this))}},render:function(){var a=React.createElement("input",{ref:"electionTitle",type:"text",className:"form-control",defaultValue:this.props.title,id:"election-title",onFocus:this.resetBorder,onChange:this.updateTitle,placeholder:"Title (e.g. Fall 2016 Election)"}),b=React.createElement("div",{className:"row pad-top"},React.createElement("div",{className:"col-sm-6"},React.createElement("div",{className:"input-group"},React.createElement("input",{placeholder:"Voting start date and time",ref:"startDate",type:"text",className:"form-control datepicker",id:"start-date",onFocus:this.resetBorder,onChange:this.changeStartDate,value:this.state.startDate}),React.createElement("div",{className:"input-group-addon"},React.createElement("i",{className:"fa fa-calendar",onClick:this.showStartCalendar})))),React.createElement("div",{className:"col-sm-6"},React.createElement("div",{className:"input-group"},React.createElement("input",{placeholder:"Voting deadline",ref:"endDate",type:"text",className:"form-control datepicker",id:"end-date",onFocus:this.resetBorder,onChange:this.changeEndDate,value:this.state.endDate}),React.createElement("div",{className:"input-group-addon"},React.createElement("i",{className:"fa fa-calendar",onClick:this.showEndCalendar}))))),c=React.createElement("div",null,React.createElement("button",{className:"btn btn-primary btn-block",onClick:this.save},React.createElement("i",{className:"fa fa-save"})," Save election"),React.createElement("button",{className:"btn btn-danger btn-block",onClick:this.props.hideForm},React.createElement("i",{className:"fa fa-times"})," Cancel")),d=React.createElement("div",{className:"row"},React.createElement("div",{className:"col-sm-9"},a,b),React.createElement("div",{className:"col-sm-3"},c));return React.createElement(Panel,{type:"info",heading:d})}});ReactDOM.render(React.createElement(ElectionList,null),document.getElementById("election-listing"));