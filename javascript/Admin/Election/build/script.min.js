"use strict";var ReactCSSTransitionGroup=React.addons.CSSTransitionGroup,Panel=React.createClass({displayName:"Panel",getDefaultProps:function(){return{type:"default",heading:"",body:"",footer:"",footerClick:null,headerClick:null}},render:function(){var a=null;this.props.heading&&(a=React.createElement("div",{className:"panel-heading",onClick:this.props.headerClick},this.props.heading));var b=null;this.props.body&&(b=React.createElement("div",{className:"panel-body"},this.props.body));var c=null;this.props.footer&&(c=React.createElement("div",{className:"panel-footer",onClick:this.props.footerClick},this.props.footer));var d="panel panel-"+this.props.type;return React.createElement("div",{className:d},a,React.createElement(ReactCSSTransitionGroup,{transitionName:"expand",transitionEnterTimeout:500,transitionLeaveTimeout:500},b),c)}}),BreakIt=function(a){if("undefined"==typeof a)throw"BreakIt text parameter is undefined";var b=a.split("\n").map(function(a,b){return React.createElement("span",{key:b},a,React.createElement("br",null))});return b},AbstainButton=function(a){return React.createElement("div",{className:"btn btn-warning btn-lg",onClick:a.handleClick},"Abstain from ",a.title," ",React.createElement("i",{className:"fa fa-arrow-right"}))},DateMixin={initStartDate:function(){$("#start-date").datetimepicker({minDate:tomorrow,value:this.state.startDate,format:dateFormat,onChangeDateTime:function(a,b){this.updateStartDate(this.refs.startDate.value)}.bind(this)})},initEndDate:function(){$("#end-date").datetimepicker({minDate:0,format:dateFormat,value:this.state.endDate,onChangeDateTime:function(a,b){this.updateEndDate(this.refs.endDate.value)}.bind(this)})},changeStartDate:function(a){this.updateStartDate(a.target.value)},changeEndDate:function(a){this.updateEndDate(a.target.value)},hasDateErrors:function(){var a=!1;return 0===this.state.startDate.length?($(this.refs.startDate).css("borderColor","red").attr("placeholder","Please enter a start date"),a=!0):this.state.unixStart>this.state.unixEnd&&($(this.refs.endDate).css("borderColor","red").attr("placeholder","End date must be greater").val(""),this.setState({endDate:"",unixEnd:0}),a=!0),0===this.state.endDate.length&&($(this.refs.endDate).css("borderColor","red").attr("placeholder","Please enter a end date"),a=!0),a},updateStartDate:function(a){var b=new Date(a),c=b.getTime()/1e3;this.setState({startDate:a,unixStart:c})},updateEndDate:function(a){var b=new Date(a),c=b.getTime()/1e3;this.setState({endDate:a,unixEnd:c})},checkForConflict:function(){return $.getJSON("election/Admin/Election",{command:"checkConflict",startDate:this.state.unixStart,endDate:this.state.unixEnd,electionId:this.props.electionId})},showStartCalendar:function(){$("#start-date").datetimepicker("show")},showEndCalendar:function(){$("#end-date").datetimepicker("show")},resetBorder:function(a){$(a.target).removeAttr("style")}},_extends=Object.assign||function(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c)Object.prototype.hasOwnProperty.call(c,d)&&(a[d]=c[d])}return a},Candidates=React.createClass({displayName:"Candidates",getInitialState:function(){return{currentForm:0}},getDefaultProps:function(){return{candidates:[],ticketId:0,multipleId:0,type:"ticket",showAdd:!0}},load:function(){this.props.reload(),this.setState({currentForm:0})},setCurrentForm:function(a){this.setState({currentForm:a})},"delete":function(a){confirm("Are you sure you want to delete this candidate?")&&$.post("election/Admin/Candidate",{command:"delete",candidateId:a},null,"json").done(function(a){this.load()}.bind(this)).fail(function(){alert("Failed to delete candidate")})},render:function(){var a=this.props.candidates.map(function(a){return a.id===this.state.currentForm?React.createElement("div",{key:a.id,className:"col-sm-4 col-xs-6 pad-bottom"},React.createElement(CandidateForm,_extends({},this.props,a,{candidateId:a.id,reload:this.load,reset:this.setCurrentForm.bind(null,0)}))):React.createElement(CandidateProfile,_extends({key:a.id},a,{"delete":this["delete"].bind(null,a.id),edit:this.setCurrentForm.bind(null,a.id)}))}.bind(this));if(0===this.state.currentForm&&this.props.showAdd&&allowChange)var b=React.createElement("div",null,React.createElement("button",{className:"btn btn-primary",onClick:this.setCurrentForm.bind(null,-1)},React.createElement("i",{className:"fa fa-user-plus fa-5x"}),React.createElement("br",null),"Add candidate"));else if(-1===this.state.currentForm)var b=React.createElement(CandidateForm,_extends({},this.props,{reload:this.load,reset:this.setCurrentForm.bind(null,0)}));return React.createElement("div",null,a,b)}}),CandidateProfile=React.createClass({displayName:"CandidateProfile",getDefaultProps:function(){return{firstName:null,lastName:null,title:null,picture:null}},render:function(){return React.createElement("div",{className:"candidate-profile"},React.createElement("div",{className:"photo-matte"},this.props.picture.length>0?React.createElement("div",null,React.createElement("span",{className:"helper"}),React.createElement("img",{src:this.props.picture,className:"img-responsive candidate-pic"})):React.createElement("div",{className:"no-picture text-muted"},React.createElement("i",{className:"fa fa-user fa-5x"}),React.createElement("br",null),"No picture")),React.createElement("div",null,React.createElement("p",null,React.createElement("strong",null,this.props.firstName," ",this.props.lastName),React.createElement("br",null),this.props.title),React.createElement("button",{className:"btn btn-primary",title:"Edit candidate",onClick:this.props.edit},React.createElement("i",{className:"fa fa-edit"}))," ",React.createElement("button",{className:"btn btn-danger",disabled:!allowChange,onClick:this.props["delete"],title:"Delete candidate"},React.createElement("i",{className:"fa fa-times"}))))}}),CandidateForm=React.createClass({displayName:"CandidateForm",getInitialState:function(){return{firstName:"",lastName:"",title:"",photo:[]}},getDefaultProps:function(){return{ticketId:0,multipleId:0,type:"ticket",candidateId:0,reload:null,firstName:"",lastName:"",title:"",picture:null,useTitle:!0}},componentWillMount:function(){this.props.candidateId>0&&this.setState({firstName:this.props.firstName,lastName:this.props.lastName,picture:this.props.picture,title:this.props.title})},updateFirstName:function(a){this.setState({firstName:a.target.value})},updateLastName:function(a){this.setState({lastName:a.target.value})},updatePhoto:function(a){this.setState({photo:a})},updateTitle:function(a){this.setState({title:a.target.value})},save:function(){var a=new FormData;a.append("command","save"),a.append("type",this.props.type),$.each(this.state.photo,function(b,c){a.append(b,c)}),this.props.ticketId>0?a.append("ticketId",this.props.ticketId):a.append("multipleId",this.props.multipleId),a.append("candidateId",this.props.candidateId),a.append("firstName",this.state.firstName),a.append("lastName",this.state.lastName),a.append("title",this.state.title),$.ajax({url:"election/Admin/Candidate",type:"POST",data:a,cache:!1,dataType:"json",processData:!1,contentType:!1,success:function(a){this.props.reload()}.bind(this),error:function(){alert("Failed to save candidate"),this.props.reload()}.bind(this)})},render:function(){var a=0===this.state.firstName.length||0===this.state.lastName.length;({firstName:this.state.firstName,lastName:this.state.lastName});return React.createElement("div",{className:"candidate-form text-center"},React.createElement(Photo,{photo:this.state.photo,update:this.updatePhoto,picture:this.state.picture}),React.createElement(CandidateInfo,_extends({updateFirstName:this.updateFirstName,updateLastName:this.updateLastName,updateTitle:this.updateTitle},this.state,{useTitle:"ticket"==this.props.type})),React.createElement("div",{className:"pad-top"},React.createElement("button",{className:"btn btn-success btn-sm",title:"Save candidate",onClick:this.save,disabled:a},React.createElement("i",{className:"fa fa-save"})," Save")," ",React.createElement("button",{className:"btn btn-danger btn-sm",title:"Cancel",onClick:this.props.reset},React.createElement("i",{className:"fa fa-times"})," Clear")))}}),CandidateInfo=React.createClass({displayName:"CandidateInfo",getDefaultProps:function(){return{firstName:null,lastName:null,title:null,useTitle:!0}},render:function(){var a=null;return this.props.useTitle&&(a=React.createElement("input",{type:"text",className:"form-control",name:"title",value:this.props.title,placeholder:"Position title",onChange:this.props.updateTitle,value:this.props.title})),React.createElement("div",null,React.createElement("input",{type:"text",className:"form-control",name:"firstName",value:this.props.firstName,placeholder:"First name",onChange:this.props.updateFirstName,value:this.props.firstName}),React.createElement("input",{type:"text",className:"form-control",name:"lastName",value:this.props.lastName,placeholder:"Last name",onChange:this.props.updateLastName,value:this.props.lastName}),a)}}),Photo=React.createClass({displayName:"Photo",getDefaultProps:function(){return{photo:[],picture:""}},onDrop:function(a){this.props.update(a)},onOpenClick:function(){this.refs.dropzone.open()},render:function(){var a,b=null;return this.props.photo.length>0?(b=this.props.photo[0].preview,a=React.createElement("img",{src:b,className:"img-responsive"})):a=this.props.picture.length?React.createElement("img",{src:this.props.picture,className:"img-responsive"}):React.createElement("div",{className:"clickme"},React.createElement("i",{className:"fa fa-camera fa-5x"}),React.createElement("br",null),React.createElement("p",null,"Click or drag image here")),React.createElement(Dropzone,{ref:"dropzone",onDrop:this.onDrop,className:"dropzone text-center"},a)}}),electionTypes={},categoryTypes={},getElectionTypes=function(){$.getJSON("election/Admin/Election",{command:"getElectionTypes"}).done(function(a){electionTypes=a,sortCategoryTypes()}.bind(this))};$(document).ready(function(){getElectionTypes()});var sortCategoryTypes=function(){electionTypes.electionTypes.forEach(function(a){a.subcategory.forEach(function(a){categoryTypes[a.type]=a.name})})},Election=React.createClass({displayName:"Election",mixins:[DateMixin],getInitialState:function(){return{editTitle:!1,showDateForm:!1,title:"",startDate:"",endDate:"",unixStart:0,unixEnd:0,past:!1}},componentDidMount:function(){this.load(),this.initStartDate(),this.initEndDate()},componentDidUpdate:function(a,b){this.state.showDateForm&&(this.initStartDate(),this.initEndDate())},load:function(){$.getJSON("election/Admin/Election",{command:"getElection",electionId:electionId}).done(function(a){this.setState({id:electionId,title:a.title,startDate:a.startDateFormatted,endDate:a.endDateFormatted,unixStart:a.startDate,unixEnd:a.endDate,editTitle:!1,showDateForm:!1})}.bind(this))},editTitle:function(){this.setState({editTitle:!0})},cancelUpdate:function(){this.setState({editTitle:!1,title:this.state.title})},updateTitle:function(a){this.setState({title:a.target.value})},saveTitle:function(){this.state.title.length>0&&$.post("election/Admin/Election",{command:"saveTitle",title:this.state.title,electionId:electionId},null,"json").done(function(a){this.load()}.bind(this))},showDateForm:function(){this.setState({showDateForm:!0})},hideDateForm:function(){this.setState({showDateForm:!1})},saveDates:function(){var a=this.hasDateErrors();if(a===!1){var b=this.checkForConflict();b.done(function(a){a.conflict===!1?$.post("election/Admin/Election",{command:"saveDates",electionId:this.state.id,startDate:this.state.unixStart,endDate:this.state.unixEnd},null,"json").done(function(a){this.load()}.bind(this)).always(function(){this.hideDateForm()}.bind(this)):($(this.refs.startDate).css("borderColor","red").attr("placeholder","Date conflict"),$(this.refs.endDate).css("borderColor","red").attr("placeholder","Date conflict"),this.setState({startDate:"",unixStart:0,endDate:"",unixEnd:0}))}.bind(this))}},render:function(){var a=React.createElement("h3",{className:"election-title",title:"Click to change title",onClick:this.editTitle},this.state.title);if(this.state.editTitle&&(a=React.createElement("div",{className:"input-group"},React.createElement("input",{type:"text",className:"form-control election-title",placeholder:"Election title",value:this.state.title,onChange:this.updateTitle}),React.createElement("span",{className:"input-group-btn"},React.createElement("button",{className:"btn btn-success",title:"Update title",disabled:0===this.state.title.length,onClick:this.saveTitle},React.createElement("i",{className:"fa fa-save"})),React.createElement("button",{className:"btn btn-danger",title:"Cancel update",onClick:this.cancelUpdate},React.createElement("i",{className:"fa fa-times"}))))),this.state.past)var b=React.createElement("h4",{className:"date-view"},this.state.startDate," - ",this.state.endDate);else if(this.state.showDateForm)var b=React.createElement("div",{className:"row date-change pad-top"},React.createElement("div",{className:"col-sm-5"},React.createElement("div",{className:"input-group"},React.createElement("input",{placeholder:"Voting start date and time",ref:"startDate",type:"text",className:"form-control datepicker",id:"start-date",onFocus:this.resetBorder,onChange:this.changeStartDate,value:this.state.startDate}),React.createElement("div",{className:"input-group-addon"},React.createElement("i",{className:"fa fa-calendar",onClick:this.showStartCalendar})))),React.createElement("div",{className:"col-sm-5"},React.createElement("div",{className:"input-group"},React.createElement("input",{placeholder:"Voting deadline",ref:"endDate",type:"text",className:"form-control datepicker",id:"end-date",onFocus:this.resetBorder,onChange:this.changeEndDate,value:this.state.endDate}),React.createElement("div",{className:"input-group-addon"},React.createElement("i",{className:"fa fa-calendar",onClick:this.showEndCalendar})))),React.createElement("div",{className:"col-sm-2"},React.createElement("button",{className:"btn btn-success btn-sm",onClick:this.saveDates},React.createElement("i",{className:"fa fa-save"}))," ",React.createElement("button",{className:"btn btn-danger btn-sm",onClick:this.hideDateForm},React.createElement("i",{className:"fa fa-times"}))));else var b=React.createElement("h4",{onClick:this.showDateForm,title:"Click to change dates"},React.createElement("span",{className:"date-edit"},this.state.startDate)," - ",React.createElement("span",{className:"date-edit"},this.state.endDate));var c=React.createElement("div",{className:"text-center pad-top"},React.createElement("i",{className:"fa fa-spinner fa-spin fa-5x"}));return this.state.id&&(c=React.createElement("div",{className:"pad-top"},React.createElement(SingleBallot,{electionId:this.state.id}),React.createElement(MultipleBallot,{electionId:this.state.id}),React.createElement(Referendum,{electionId:this.state.id}))),React.createElement("div",null,a,b,allowChange?null:React.createElement("p",null,React.createElement("em",null,"This is an ongoing election. Some options are disabled.")),React.createElement("div",null,c))}});ReactDOM.render(React.createElement(Election,null),document.getElementById("election-dashboard"));var _extends=Object.assign||function(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c)Object.prototype.hasOwnProperty.call(c,d)&&(a[d]=c[d])}return a},MultipleBallot=React.createClass({displayName:"MultipleBallot",mixins:["Panel"],getInitialState:function(){return{multipleList:[],itemCount:0,panelOpen:!1,showForm:!1,categoryList:[]}},getDefaultProps:function(){return{electionId:0}},componentDidMount:function(){this.load()},load:function(){$.getJSON("election/Admin/Multiple",{command:"list",electionId:this.props.electionId}).done(function(a){this.setState({itemCount:a.length,multipleList:a})}.bind(this))},toggleExpand:function(){this.setState({panelOpen:!this.state.panelOpen})},showForm:function(a){a.preventDefault(),a.stopPropagation(),this.setState({panelOpen:!0,showForm:!0})},hideForm:function(){this.setState({showForm:!1})},render:function(){var a=React.createElement("div",{className:"row"},React.createElement("div",{className:"col-sm-9"},React.createElement("h4",null,"Multiple chair - ",this.state.itemCount," ballot",1!==this.state.itemCount?"s":null)),React.createElement("div",{className:"col-sm-3"},React.createElement("button",{className:"btn btn-block btn-primary",onClick:this.showForm,disabled:!allowChange},React.createElement("i",{className:"fa fa-plus"})," New ballot")));if(this.state.panelOpen){var b=null;this.state.showForm&&(b=React.createElement(MultipleForm,{electionId:this.props.electionId,reload:this.load,hideForm:this.hideForm}));var c=React.createElement("div",null,b,React.createElement(MultipleList,{electionId:this.props.electionId,reload:this.load,listing:this.state.multipleList})),d=React.createElement("i",{className:"fa fa-chevron-up"})}else var c=null,d=React.createElement("i",{className:"fa fa-chevron-down"});var e=React.createElement("div",{className:"text-center pointer",onClick:this.toggleExpand},d);return React.createElement(Panel,{type:"info",heading:a,body:c,footer:e,headerClick:this.toggleExpand,footerClick:this.toggleExpand})}}),MultipleList=React.createClass({displayName:"MultipleList",getInitialState:function(){return{currentEdit:-1,openMultiple:0}},getDefaultProps:function(){return{listing:[],reload:null,electionId:0}},editRow:function(a){this.setState({currentEdit:a})},openMultiple:function(a){a===this.state.openMultiple&&(a=0),this.setState({openMultiple:a})},render:function(){var a=React.createElement("div",null,React.createElement("h3",null,"No multiple chair ballots found.")),b={electionId:this.props.electionId,reload:this.props.reload,hideForm:this.editRow.bind(null,-1),openMultiple:this.openMultiple},a=this.props.listing.map(function(a){return a.id===this.state.currentEdit?React.createElement(MultipleForm,_extends({key:a.id},a,{multipleId:a.id},b)):React.createElement(MultipleListRow,_extends({key:a.id},a,{isOpen:this.state.openMultiple===a.id,multipleId:a.id,edit:this.editRow.bind(null,a.id)},b))}.bind(this));return React.createElement("div",null,React.createElement("div",{className:"pad-top"},a))}}),MultipleListRow=React.createClass({displayName:"MultipleListRow",mixins:["Panel"],getDefaultProps:function(){return{electionId:0,reload:null,hideForm:null,multipleId:0,title:"",seatNumber:0,category:"",isOpen:!0}},getInitialState:function(){return{formId:-1,candidates:[],candidateCount:0}},componentDidMount:function(){this.load()},load:function(){$.getJSON("election/Admin/Candidate",{command:"candidateList",multipleId:this.props.multipleId}).done(function(a){this.setState({candidates:a,candidateCount:a.length})}.bind(this))},toggleExpand:function(){this.props.openMultiple(this.props.multipleId)},handleDelete:function(a){confirm("Are you sure you want to delete this ballot?")&&$.post("election/Admin/Multiple",{command:"delete",ballotId:this.props.id},null,"json").done(function(a){this.props.reload()}.bind(this))},edit:function(a){a.stopPropagation(),this.props.edit()},render:function(){var a=React.createElement("div",{className:"row"},React.createElement("div",{className:"col-sm-9"},React.createElement("div",{className:"ballot-title"},this.props.title," - ",this.state.candidateCount," candidate",1!==this.state.candidateCount?"s":null),React.createElement("div",null,React.createElement("strong",null,"Available seats:")," ",this.props.seatNumber),React.createElement("div",null,React.createElement("strong",null,"Voting category:")," ",React.createElement(CategoryTitle,{category:this.props.category}))),React.createElement("div",{className:"col-sm-3"},React.createElement("button",{className:"btn btn-success btn-block",onClick:this.edit,title:"Edit ballot"},React.createElement("i",{className:"fa fa-edit"})," Edit"),React.createElement("button",{disabled:!allowChange,className:"btn btn-danger btn-block",onClick:this.handleDelete},React.createElement("i",{className:"fa fa-trash-o",title:"Remove ballot"})," Delete")));if(this.props.isOpen)var b=React.createElement(Candidates,{type:"multiple",electionId:this.props.electionId,multipleId:this.props.multipleId,candidates:this.state.candidates,reload:this.load}),c=React.createElement("i",{className:"fa fa-chevron-up"});else var b=null,c=React.createElement("i",{className:"fa fa-chevron-down"});var d=React.createElement("div",{className:"text-center pointer"},c);return React.createElement(Panel,{type:"success",heading:a,body:b,footer:d,footerClick:this.toggleExpand,headerClick:this.toggleExpand})}}),CategoryTitle=function(a){return React.createElement("span",null,categoryTypes[a.category])},MultipleForm=React.createClass({displayName:"MultipleForm",getInitialState:function(){return{title:"",seatNumber:"2",category:""}},getDefaultProps:function(){return{multipleId:0,electionId:0,title:"",seatNumber:"2",category:"",hideForm:null,reload:null}},componentWillMount:function(){this.props.id&&this.copyPropsToState()},componentDidMount:function(){this.state.category.length||this.setState({category:electionTypes.electionTypes[0].subcategory[0].type})},copyPropsToState:function(){this.setState({title:this.props.title,seatNumber:this.props.seatNumber,category:this.props.category})},updateTitle:function(a){this.setState({title:a.target.value})},updateSeatNumber:function(a){var b=a.target.value;return 1>b?void(a.target.value="1"):void this.setState({seatNumber:a.target.value})},updateCategory:function(a){this.setState({category:a.target.value})},checkForErrors:function(){var a=!1;return 0===this.state.title.length&&($(this.refs.multipleTitle).css("borderColor","red").attr("placeholder","Please enter a title"),a=!0),this.state.seatNumber<1&&(a=!0),a},save:function(){var a=this.checkForErrors();a===!1&&$.post("election/Admin/Multiple",{command:"save",multipleId:this.props.multipleId,electionId:this.props.electionId,title:this.state.title,seatNumber:this.state.seatNumber,category:this.state.category},null,"json").done(function(a){this.props.reload()}.bind(this)).always(function(){this.props.hideForm()}.bind(this))},resetBorder:function(a){$(a.target).removeAttr("style")},render:function(){var a=React.createElement("div",{className:"row"},React.createElement("div",{className:"col-sm-9"},React.createElement("div",{className:"row"},React.createElement("div",{className:"col-sm-12"},React.createElement("label",null,"Ballot title (e.g. Sophomore Senate)"),React.createElement("input",{ref:"multipleTitle",type:"text",className:"form-control",defaultValue:this.props.title,id:"multiple-title",min:"2",onFocus:this.resetBorder,onChange:this.updateTitle}))),React.createElement("div",{className:"row"},React.createElement("div",{className:"col-sm-4"},React.createElement("label",null,"Available seats"),React.createElement("input",{ref:"seatNumber",type:"number",className:"form-control",onChange:this.updateSeatNumber,defaultValue:this.props.seatNumber})),React.createElement("div",{className:"col-sm-8"},React.createElement("label",null,"Filter"),React.createElement(CategoryList,{"default":this.state.category,handleChange:this.updateCategory})))),React.createElement("div",{className:"col-sm-3"},React.createElement("div",null,React.createElement("button",{className:"btn btn-block btn-primary",onClick:this.save},React.createElement("i",{className:"fa fa-save"})," Save"),React.createElement("button",{className:"btn btn-block btn-danger",onClick:this.props.hideForm},React.createElement("i",{className:"fa fa-times"})," Cancel"))));return React.createElement(Panel,{type:"success",heading:a})}}),CategoryList=React.createClass({displayName:"CategoryList",getDefaultProps:function(){return{"default":"",handleChange:null}},render:function(){var a=electionTypes.electionTypes.map(function(a,b){return React.createElement(CategoryOption,{key:b,category:a.category,subcategory:a.subcategory})});return React.createElement("select",{className:"form-control",defaultValue:this.props.defValue,onChange:this.props.handleChange,value:this.props["default"]},a)}}),CategoryOption=React.createClass({displayName:"CategoryOption",getDefaultProps:function(){return{category:"",subcategory:[]}},render:function(){var a=this.props.subcategory.map(function(a,b){return React.createElement("option",{key:b,value:a.type},a.name)}.bind(this));return React.createElement("optgroup",{label:this.props.category},a)}}),_extends=Object.assign||function(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c)Object.prototype.hasOwnProperty.call(c,d)&&(a[d]=c[d])}return a},Referendum=React.createClass({displayName:"Referendum",getInitialState:function(){return{referendumList:[],itemCount:0,showForm:!1,panelOpen:!1}},getDefaultProps:function(){return{electionId:0}},componentDidMount:function(){this.load()},load:function(){$.getJSON("election/Admin/Referendum",{command:"list",electionId:this.props.electionId}).done(function(a){this.setState({itemCount:a.length,referendumList:a})}.bind(this))},toggleExpand:function(){this.setState({panelOpen:!this.state.panelOpen})},showForm:function(a){a.preventDefault(),a.stopPropagation(),this.setState({panelOpen:!0,showForm:!0})},hideForm:function(){this.setState({showForm:!1})},render:function(){var a=React.createElement("div",{className:"row"},React.createElement("div",{className:"col-sm-8"},React.createElement("h4",null,"Referendum - ",this.state.itemCount," measure",1!==this.state.itemCount?"s":null)),React.createElement("div",{className:"col-sm-4"},React.createElement("button",{className:"btn btn-block btn-primary",onClick:this.showForm,disabled:!allowChange},React.createElement("i",{className:"fa fa-plus"})," New referendum")));if(this.state.panelOpen){var b=null;this.state.showForm&&(b=React.createElement(ReferendumForm,{electionId:this.props.electionId,reload:this.load,hideForm:this.hideForm}));var c=React.createElement("div",null,b,React.createElement(ReferendumList,{electionId:this.props.electionId,reload:this.load,listing:this.state.referendumList})),d=React.createElement("i",{className:"fa fa-chevron-up"})}else var c=null,d=React.createElement("i",{className:"fa fa-chevron-down"});var e=React.createElement("div",{className:"text-center pointer",onClick:this.toggleExpand},d);return React.createElement(Panel,{type:"info",heading:a,body:c,footer:e,headerClick:this.toggleExpand,footerClick:this.toggleExpand})}}),ReferendumList=React.createClass({displayName:"ReferendumList",getInitialState:function(){return{currentEdit:-1,openReferendum:0}},getDefaultProps:function(){return{listing:[],reload:null,electionId:0}},editRow:function(a){this.setState({currentEdit:a})},openReferendum:function(a){a===this.state.openreferendum&&(a=0),this.setState({openReferendum:a})},render:function(){var a=(React.createElement("div",null,React.createElement("h3",null,"No referendums found.")),{electionId:this.props.electionId,reload:this.props.reload,hideForm:this.editRow.bind(null,-1),openReferendum:this.openReferendum}),b=this.props.listing.map(function(b){return b.id===this.state.currentEdit?React.createElement(ReferendumForm,_extends({key:b.id},b,{referendumId:b.id},a)):React.createElement(ReferendumListRow,_extends({key:b.id},b,{isOpen:this.state.openReferendum===b.id,referendumId:b.id,edit:this.editRow.bind(null,b.id)},a))}.bind(this));return React.createElement("div",{className:"pad-top"},b)}}),ReferendumForm=React.createClass({displayName:"ReferendumForm",getInitialState:function(){return{title:"",description:""}},getDefaultProps:function(){return{referendumId:0,electionId:0,title:"",description:"",hideForm:null,reload:null}},componentWillMount:function(){this.props.id&&this.copyPropsToState()},copyPropsToState:function(){this.setState({title:this.props.title,description:this.props.description})},updateTitle:function(a){this.setState({title:a.target.value})},updateDescription:function(a){this.setState({description:a.target.value})},checkForErrors:function(){var a=!1;return this.state.title.length||($(this.refs.referendumTitle).css("borderColor","red").attr("placeholder","Please enter a title"),a=!0),this.state.description.length||($(this.refs.referendumDescription).css("borderColor","red").attr("placeholder","Please enter a description"),a=!0),a},save:function(){var a=this.checkForErrors();a===!1&&$.post("election/Admin/Referendum",{command:"save",electionId:this.props.electionId,referendumId:this.props.referendumId,title:this.state.title,description:this.state.description},null,"json").done(function(a){this.props.reload()}.bind(this)).always(function(){this.props.hideForm()}.bind(this))},resetBorder:function(a){$(a.target).removeAttr("style")},render:function(){var a=React.createElement("div",null,React.createElement("input",{ref:"referendumTitle",type:"text",className:"form-control",defaultValue:this.props.title,id:"referendum-title",onFocus:this.resetBorder,onChange:this.updateTitle,placeholder:"Title of referendum"})),b=React.createElement("div",null,React.createElement("div",null,React.createElement("textarea",{ref:"referendumDescription",className:"form-control",defaultValue:this.props.description,id:"referendum-description",onFocus:this.resetBorder,onChange:this.updateDescription,placeholder:"Description of referendum"})),React.createElement("div",{className:"pad-top"},React.createElement("button",{className:"btn btn-primary pull-left pad-right",onClick:this.save},React.createElement("i",{className:"fa fa-save"})," Save"),React.createElement("button",{className:"btn btn-danger",onClick:this.props.hideForm},React.createElement("i",{className:"fa fa-times"})," Cancel")));return React.createElement(Panel,{type:"success",heading:a,body:b})}}),ReferendumListRow=React.createClass({displayName:"ReferendumListRow",mixins:["Panel"],getInitialState:function(){return{formId:-1}},getDefaultProps:function(){return{electionId:0,reload:null,hideForm:null,referendumId:0,title:"",description:"",isOpen:!0,edit:null,openReferendum:null}},deleteReferendum:function(){confirm("Are you sure you want to delete this referendum?")&&$.post("election/Admin/Referendum",{command:"delete",referendumId:this.props.referendumId},null,"json").done(function(a){this.props.reload()}.bind(this))},render:function(){var a=React.createElement("div",{className:"row"},React.createElement("div",{className:"col-sm-8"},React.createElement("h3",null,this.props.title)),React.createElement("div",{className:"col-sm-4 text-right"},React.createElement("button",{className:"btn btn-success pad-right",onClick:this.props.edit},React.createElement("i",{className:"fa fa-edit"})," Edit"),React.createElement("button",{disabled:!allowChange,className:"btn btn-danger",onClick:this.deleteReferendum},React.createElement("i",{className:"fa fa-trash-o"})," Delete"))),b=React.createElement("p",null,this.props.description.split("\n").map(function(a,b){return React.createElement("span",{key:b},a,React.createElement("br",null))}));return React.createElement(Panel,{type:"success",heading:a,body:b})}}),_extends=Object.assign||function(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c)Object.prototype.hasOwnProperty.call(c,d)&&(a[d]=c[d])}return a},SingleBallot=React.createClass({displayName:"SingleBallot",mixins:["Panel"],getInitialState:function(){return{singleList:[],itemCount:0,showForm:!1,panelOpen:!0}},getDefaultProps:function(){return{electionId:0}},componentDidMount:function(){this.load()},load:function(){$.getJSON("election/Admin/Single",{command:"list",electionId:this.props.electionId}).done(function(a){this.setState({itemCount:a.length,singleList:a})}.bind(this))},toggleExpand:function(){this.setState({panelOpen:!this.state.panelOpen})},showForm:function(a){a.preventDefault(),a.stopPropagation(),this.setState({panelOpen:!0,showForm:!0})},hideForm:function(){this.setState({showForm:!1})},render:function(){var a=React.createElement("div",{className:"row"},React.createElement("div",{className:"col-sm-9"},React.createElement("h4",null,"Single chair - ",this.state.itemCount," ballot",1!==this.state.itemCount?"s":null)),React.createElement("div",{
className:"col-sm-3"},React.createElement("button",{className:"btn btn-block btn-primary",disabled:!allowChange,onClick:this.showForm},React.createElement("i",{className:"fa fa-plus"})," New ballot")));if(this.state.panelOpen){var b=null;this.state.showForm&&(b=React.createElement(SingleBallotForm,{electionId:this.props.electionId,reload:this.load,hideForm:this.hideForm}));var c=React.createElement("div",null,b,React.createElement(SingleList,{electionId:this.props.electionId,reload:this.load,hideForm:this.hideForm,listing:this.state.singleList})),d=React.createElement("i",{className:"fa fa-chevron-up"})}else var c=null,d=React.createElement("i",{className:"fa fa-chevron-down"});var e=React.createElement("div",{className:"text-center pointer",onClick:this.toggleExpand},d);return React.createElement(Panel,{type:"info",heading:a,body:c,footer:e,headerClick:this.toggleExpand,footerClick:this.toggleExpand})}}),SingleList=React.createClass({displayName:"SingleList",getInitialState:function(){return{currentEdit:-1,openSingle:0}},getDefaultProps:function(){return{listing:[],reload:null,electionId:0}},setCurrentEdit:function(a){this.props.hideForm(),this.setState({currentEdit:a})},openSingle:function(a){a===this.state.openSingle&&(a=0),this.setState({openSingle:a})},componentDidUpdate:function(a,b){},render:function(){var a=React.createElement("div",null,React.createElement("h3",null,"No single ballots found.")),b={electionId:this.props.electionId,reload:this.props.reload,hideForm:this.setCurrentEdit.bind(null,-1),openSingle:this.openSingle},a=this.props.listing.map(function(a){return a.id===this.state.currentEdit?React.createElement(SingleBallotForm,_extends({key:a.id},a,{singleId:a.id},b)):React.createElement(SingleListRow,_extends({key:a.id},a,{isOpen:this.state.openSingle===a.id,singleId:a.id,edit:this.setCurrentEdit.bind(null,a.id)},b))}.bind(this));return React.createElement("div",null,React.createElement("div",{className:"pad-top"},a))}}),SingleListRow=React.createClass({displayName:"SingleListRow",mixins:["Panel"],getDefaultProps:function(){return{electionId:0,reload:null,hideForm:null,singleId:0,title:"",isOpen:!0}},getInitialState:function(){return{formId:-1,tickets:[],ticketCount:0}},componentDidMount:function(){this.load()},load:function(){$.getJSON("election/Admin/Ticket",{command:"list",singleId:this.props.singleId}).done(function(a){this.setState({tickets:a,ticketCount:a.length})}.bind(this))},toggleExpand:function(){this.props.openSingle(this.props.singleId)},handleDelete:function(a){confirm("Are you sure you want to delete this ballot?")&&$.post("election/Admin/Single",{command:"delete",singleId:this.props.id},null,"json").done(function(a){this.props.reload()}.bind(this))},edit:function(a){a.stopPropagation(),this.props.edit()},render:function(){var a=React.createElement("div",{className:"row"},React.createElement("div",{className:"col-sm-6"},React.createElement("div",{className:"ballot-title"},this.props.title," - ",this.state.ticketCount," ticket",1!==this.state.ticketCount?"s":null)),React.createElement("div",{className:"col-sm-6"},React.createElement("div",{className:"pull-right"},React.createElement("button",{className:"btn btn-success pad-right",onClick:this.edit,title:"Edit ballot"},React.createElement("i",{className:"fa fa-edit"})," Edit"),React.createElement("button",{disabled:!allowChange,className:"btn btn-danger",onClick:this.handleDelete},React.createElement("i",{className:"fa fa-trash-o",title:"Remove ballot"})," Delete"))));if(this.props.isOpen)var b=React.createElement("div",null,React.createElement(Tickets,{singleId:this.props.singleId,tickets:this.state.tickets,load:this.load})),c=React.createElement("i",{className:"fa fa-chevron-up"});else var b=null,c=React.createElement("i",{className:"fa fa-chevron-down"});var d=React.createElement("div",{className:"text-center pointer"},c);return React.createElement(Panel,{type:"success",heading:a,body:b,footer:d,footerClick:this.toggleExpand,headerClick:this.toggleExpand})}}),SingleBallotForm=React.createClass({displayName:"SingleBallotForm",getInitialState:function(){return{title:""}},getDefaultProps:function(){return{singleId:0,electionId:0,title:"",hideForm:null,reload:null}},componentWillMount:function(){this.props.id&&this.copyPropsToState()},copyPropsToState:function(){this.setState({title:this.props.title})},updateTitle:function(a){this.setState({title:a.target.value})},checkForErrors:function(){var a=!1;return 0===this.state.title.length&&($(this.refs.ballotTitle).css("borderColor","red").attr("placeholder","Please enter a title"),a=!0),a},save:function(){var a=this.checkForErrors();a===!1&&$.post("election/Admin/Single",{command:"save",singleId:this.props.singleId,electionId:this.props.electionId,title:this.state.title},null,"json").done(function(a){this.props.reload()}.bind(this)).fail(function(){alert("Could not save single chair ballot")}).always(function(){this.props.hideForm()}.bind(this))},resetBorder:function(a){$(a.target).removeAttr("style")},render:function(){var a=React.createElement("div",{className:"row"},React.createElement("div",{className:"col-sm-8"},React.createElement("input",{ref:"singleTitle",type:"text",className:"form-control",defaultValue:this.props.title,id:"single-title",onFocus:this.resetBorder,onChange:this.updateTitle,placeholder:"Ballot title (e.g. President/Vice President)"})),React.createElement("div",{className:"col-sm-4"},React.createElement("div",{className:"pull-right"},React.createElement("button",{className:"btn btn-primary pad-right",onClick:this.save},React.createElement("i",{className:"fa fa-save"})," Save"),React.createElement("button",{className:"btn btn-danger",onClick:this.props.hideForm},React.createElement("i",{className:"fa fa-times"})," Cancel"))));return React.createElement(Panel,{type:"success",heading:a})}}),_extends=Object.assign||function(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c)Object.prototype.hasOwnProperty.call(c,d)&&(a[d]=c[d])}return a},Tickets=React.createClass({displayName:"Tickets",getInitialState:function(){return{ticketFormId:-1}},getDefaultProps:function(){return{singleId:0,tickets:[]}},editFormId:function(a){this.setState({ticketFormId:a})},"delete":function(a){confirm("Are you sure you want to delete this ticket?")&&$.post("election/Admin/Ticket",{command:"delete",ticketId:a},null,"json").done(function(a){this.props.load()}.bind(this)).fail(function(){alert("Unable to delete this ticket."),this.props.load()})},render:function(){var a={close:this.editFormId.bind(null,-1),load:this.props.load,singleId:this.props.singleId},b=null;b=0===this.state.ticketFormId?React.createElement(TicketForm,_extends({},a,{singleId:this.props.singleId})):React.createElement("button",{disabled:!allowChange,className:"btn btn-primary",onClick:this.editFormId.bind(null,0)},React.createElement("i",{className:"fa fa-plus"})," Add a new ticket");var c=React.createElement("div",null,"No tickets yet!");return this.props.tickets.length>0&&(c=this.props.tickets.map(function(b){return b.id===this.state.ticketFormId?React.createElement(TicketForm,_extends({key:b.id,ticketId:b.id},b,a)):React.createElement(TicketRow,_extends({key:b.id},b,{handleEdit:this.editFormId.bind(null,b.id),handleDelete:this["delete"].bind(null,b.id)}))}.bind(this))),React.createElement("div",null,b,React.createElement("div",{className:"pad-top"},c))}}),TicketForm=React.createClass({displayName:"TicketForm",getInitialState:function(){return{title:null,siteAddress:null,platform:null,siteAddressError:!1}},getDefaultProps:function(){return{close:null,load:null,singleId:0,ticketId:0,title:null,siteAddress:null,platform:null}},componentWillMount:function(){this.props.id>0&&this.copyPropsToState()},copyPropsToState:function(){this.setState({title:this.props.title,siteAddress:this.props.siteAddress,platform:this.props.platform})},checkForErrors:function(){var a=!1,b=this.refs.title.value;return 0===b.length&&($(this.refs.title).css("borderColor","red").attr("placeholder","Please enter a title"),a=!0),a},checkUrl:function(){return this.state.siteAddress&&this.state.siteAddress.length>0?void $.getJSON("election/Admin/Ticket",{command:"checkUrl",checkUrl:this.state.siteAddress}).done(function(a){return a.success&&a.success!==!1?(this.setState({siteAddressError:!1}),$(this.refs.siteAddress).css("borderColor","inherit"),!0):(this.setState({siteAddressError:!0}),$(this.refs.siteAddress).css("borderColor","red"),!1)}.bind(this)):(this.setState({siteAddressError:!1}),$(this.refs.siteAddress).css("borderColor","inherit"),!0)},save:function(){var a=this.checkForErrors();a===!1&&this.state.siteAddressError===!1&&$.post("election/Admin/Ticket",{command:"save",singleId:this.props.singleId,ticketId:this.props.ticketId,title:this.state.title,siteAddress:this.state.siteAddress,platform:this.state.platform},null,"json").done(function(a){this.props.load()}.bind(this)).always(function(){this.props.close()}.bind(this)).fail(function(){alert("Sorry but an error occurred when trying to save your ticket.")})},changeTitle:function(a){this.setState({title:a.target.value})},changeSiteAddress:function(a){var b=a.target.value;0===b.length&&this.setState({siteAddressError:!1}),this.setState({siteAddress:b})},changePlatform:function(a){this.setState({platform:a.target.value})},resetBorder:function(a){$(a.target).css("borderColor","inherit")},render:function(){var a=React.createElement("div",{className:"col-xs-12 col-sm-8"},React.createElement("div",{className:"row"},React.createElement("div",{className:"col-sm-2"},React.createElement("label",{htmlFor:"title",className:"control-label pad-right"},"Title:")),React.createElement("div",{className:"col-sm-10"},React.createElement("input",{ref:"title",type:"text",className:"form-control",onFocus:this.resetBorder,placeholder:"Candidate last names (e.g. Jones / Smith)",onChange:this.changeTitle,value:this.state.title}))),React.createElement("div",{className:"row pad-top"},React.createElement("div",{className:"col-sm-2"},React.createElement("label",{htmlFor:"siteAddress",className:"control-label pad-right"},"Site address:")),React.createElement("div",{className:"col-sm-10"},React.createElement("input",{ref:"siteAddress",type:"text",className:"form-control",placeholder:"http://siteaddress.com",onFocus:this.resetBorder,onBlur:this.checkUrl,onChange:this.changeSiteAddress,value:this.state.siteAddress}),this.state.siteAddressError?React.createElement("div",{className:"text-danger"},"Site address format not accepted."):null)),React.createElement("div",{className:"row pad-top"},React.createElement("div",{className:"col-sm-2"},React.createElement("label",{htmlFor:"platform",className:"control-label pad-right"},"Platform:")),React.createElement("div",{className:"col-sm-10"},React.createElement("textarea",{ref:"platform",className:"form-control",onFocus:this.resetBorder,placeholder:"Ticket's election statement",onChange:this.changePlatform,value:this.state.platform,maxLength:500}),React.createElement("span",null,"500 character limit"))),React.createElement("hr",null),React.createElement("button",{className:"btn btn-primary pad-right",onClick:this.save,disabled:this.state.siteAddressError},React.createElement("i",{className:"fa fa-save"})," Save ticket"),React.createElement("button",{className:"btn btn-danger",onClick:this.props.close},React.createElement("i",{className:"fa fa-times"})," Cancel"));return React.createElement("div",null,React.createElement(Panel,{body:a}))}}),TicketRow=React.createClass({displayName:"TicketRow",mixins:["Panel"],getInitialState:function(){return{candidates:[]}},getDefaultProps:function(){return{id:0,title:null,platform:"",siteAddress:"",handleDelete:null}},componentDidMount:function(){this.load()},load:function(){$.getJSON("election/Admin/Candidate",{command:"ticketList",ticketId:this.props.id}).done(function(a){this.setState({candidates:a})}.bind(this))},render:function(){var a=React.createElement("em",null,"No platform");this.props.platform.length>0&&(a=React.createElement("p",null,this.props.platform.split("\n").map(function(a,b){return React.createElement("span",{key:b},a,React.createElement("br",null))})));var b=this.state.candidates.length<2,c=React.createElement("div",{className:"ticket-form-view"},React.createElement("div",{className:"change-buttons"},React.createElement("button",{className:"btn btn-sm btn-success","data-tid":this.props.id,onClick:this.props.handleEdit,title:"Edit ticket"},React.createElement("i",{className:"fa fa-lg fa-edit"})," Edit ticket"),React.createElement("button",{disabled:!allowChange,className:"btn btn-sm btn-danger",onClick:this.props.handleDelete,title:"Delete ticket"},React.createElement("i",{className:"fa fa-lg fa-trash-o"})," Delete ticket")),React.createElement("div",{className:"ticket-title"},this.props.title),React.createElement("div",null,a,React.createElement("div",null,this.props.siteAddress.length?React.createElement("p",null,React.createElement("strong",null,"Web site:")," ",React.createElement("a",{href:this.props.siteAddress,target:"_blank"},this.props.siteAddress)):React.createElement("em",null,"No website"))),React.createElement("hr",null),React.createElement(Candidates,{type:"ticket",candidates:this.state.candidates,singleId:this.props.singleId,ticketId:this.props.id,reload:this.load,showAdd:b}));return React.createElement("div",null,React.createElement(Panel,{body:c}))}});